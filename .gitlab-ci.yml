stages:
  - test
  - deploy


test:
  image: golang:1.20.4 
  stage: test
  needs: []
  script:
    - go fmt $(go list ./... | grep -v /vendor/)
    - go vet -composites=false $(go list ./... | grep -v /vendor/)
    - go test -race $(go list ./... | grep -v /vendor/)


deploy-railway:
  stage: deploy
  image: ubuntu
  only:
    - master
  script:
    - apt-get update && apt-get install -y curl
    - curl -fsSL https://railway.app/install.sh | sh
    - railway up --service=$RAILWAY_SERVICE_NAME -d